{% extends "FTFSDashboardBundle::layout.html.twig" %}

{% block body_content %}
    {% if is_granted('ROLE_AGENT') %}
        {% include 'FTFSDashboardBundle:MyService:show_content_agent.html.twig' with {
            'read_only' : entity.assignedTo is null or entity.assignedTo.username != app.user.username or entity.status not in ['interrupted', 'assigned', 'opened'],
        } %}
    {% elseif is_granted('ROLE_CLIENT') %}
        {% include 'FTFSDashboardBundle:MyService:show_content_client.html.twig' with { 
            'read_only' : entity.requestedBy.username != app.user.username or entity.status == 'closed', 
        } %}
    {% endif %}
{% endblock %}

{% block javascript %}
    {{ parent() }}
    <script>
        // on loading ...
        $(function() {
            // loading file attachment to 'div#attachment-ajax'
            $.ajax({
                type:   "POST",
                url:    "{{ path(prefix~'_attachment_list', {'id' : entity.id }) }}",
                data:   "",
                cache:  false,
                success: function(data) {
                    $('div#attachment-ajax').html(data);
                    },
                error:   function() {
                    alert("Ooups ... something's got wrong: the ajax connection failed in rendering attachment list:(");
                    },
            });
            // loading observation to 'div#observation'
            $.ajax({
                type:   "POST",
                url:    "{{ path(prefix~'_show_observation', {'id' : entity.id, 'limit' : '3' }) }}",
                data:   "",
                cache:  false,
                success: function(data) {
                    $('div#observation').html(data);
                    },
                error:   function() {
                    alert("Ooups ... something's got wrong: the ajax connection failed in rendering show observation list:(");
                    },
            });
        });

    </script>
{% endblock %}
