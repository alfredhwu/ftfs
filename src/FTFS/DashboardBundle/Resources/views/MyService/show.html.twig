{% extends "FTFSDashboardBundle::layout.html.twig" %}

{% block body_content %}
    {% if is_granted('ROLE_AGENT') %}
        {% include 'FTFSDashboardBundle:MyService:show_content_agent.html.twig' with {
            'read_only' : entity.assignedTo is null or entity.assignedTo.username != app.user.username or entity.status not in ['interrupted', 'assigned', 'opened'],
        } %}
    {% elseif is_granted('ROLE_CLIENT') %}
        {% include 'FTFSDashboardBundle:MyService:show_content_client.html.twig' with { 
            'read_only' : entity.requestedBy.username != app.user.username or entity.status == 'closed', 
        } %}
    {% endif %}
{% endblock %}

{% block javascript %}
    {{ parent() }}
    <script>
        $(function() {
            var DATA = "";
            $.ajax({
                type:   "POST",
                url:    "{{ path(prefix~'_show_observation', {'id' : entity.id }) }}",
                data:   DATA,
                cache:  false,
                success: function(data) {
                    $('div#observation').html(data);
                    },
                error:   function() {
                    alert("Ooups ... something's got wrong: the ajax connection failed :(");
                    },
            });
            $('a.observation-new').click(function(e) {
                e.preventDefault();
                $('form#observation_new').show();
            });
        });
    </script>
{% endblock %}
