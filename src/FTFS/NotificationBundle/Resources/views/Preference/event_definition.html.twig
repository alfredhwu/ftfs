{% extends 'FTFSPreferenceBundle::layout.html.twig' %}
{% block body_content %}
<legend>
    <span>Auto Notification<span>
    <a href="{{ path('ftfs_notificationbundle_preference_event_add', { 'auto' : 1 }) }}" class="btn btn-success pull-right">
        <i class="icon-plus-sign icon-white"></i>
        add a new event
    </a>
</legend>
<table class="table table-striped table-condensed table-bordered table-smart">
    <tr>
        <th class="tight"></th>
        <th>Name</th>
        <th>Notification Method</th>
    </tr>
    {% set index = 0 %}
    {% for event in events %}
    <tr>
        {% set index = index + 1 %}
        <td class="tight">{{ index }}</td>
        <td>{{ ('ftfs_notification_key.'~event.eventKey) |trans({}, 'notification') }}</td>
        <td class="methods_form" id="{{ 'methods_for_'~event.id }}" event-id="{{ event.id }}" auto=1>...</td>
    </tr>
    {% endfor %}
</table>

<legend>
    <span>Notification for actions of other actors<span>
    <a href="{{ path('ftfs_notificationbundle_preference_event_add', { 'auto' : 0 }) }}" class="btn btn-success pull-right">
        <i class="icon-plus-sign icon-white"></i>
        add a new event
    </a>
</legend>
<table class="table table-striped table-condensed table-bordered table-smart">
    <tr>
        <th class="tight"></th>
        <th>Name</th>
        <th>Notification Method</th>
    </tr>
    {% set index = 0 %}
    {% for event in events %}
    <tr>
        {% set index = index + 1 %}
        <td class="tight">{{ index }}</td>
        <td>{{ ('ftfs_notification_key.'~event.eventKey) |trans({}, 'notification') }}</td>
        <td class="methods_form" id="{{ 'methods_for_'~event.id }}" event-id="{{ event.id }}" auto=0>...</td>
    </tr>
    {% endfor %}
</table>
{% endblock %}

{% block javascript %}
{{ parent() }}
<!-- loading method forms -->
<script>
$(document).ready(function () {
    var URL = "{{ path('ftfs_notificationbundle_preference_event_catch_filter_default', { 'id' : '_event', 'auto' : '_auto' }) }}";
    $('td.methods_form').each(function() {
        var event_id = $(this).attr('event-id');
        var auto = $(this).attr('auto');
        var id = $(this).attr('id');
        var href = URL.replace(/_event/, event_id);
        href = href.replace(/_auto/, auto);
        alert(href);
        // load form
        $.ajax({
            type:   "GET",
            url:    href,
            data:   "",
            cache:  false,
            success: function(data) {
                $('td#'+id).html(data);
            },
            error:   function() {
                alert("Ooups ... something's got wrong: the ajax connection failed in rendering methods form:(");
            },
        });
    });
});
</script>
{% endblock %}
